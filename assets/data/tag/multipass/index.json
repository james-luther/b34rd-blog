{"hash":"7eea66335e3101fb2bdf96a4df7b72a3d5630259","data":{"tag":{"id":"multipass","title":"multipass","path":"/tag/multipass/","belongsTo":{"totalCount":1,"pageInfo":{"totalPages":1,"currentPage":1},"edges":[{"node":{"id":"9158022d6e1bca624634e3e549d0bb4e","title":"K3S Test Lab at Home","datetime":"2022-11-25 00:00:00","path":"/k3-s-test-lab-at-home/","content":"<p>Do you work in the cloud with Kubernetes? Do you want to test things without affecting any of the clusters you work with? Well, I'm going to show you the easiest way to do it! You don't need anything other than your home computer/laptop and an internet conection! Let's get into it!</p>\n<h3 id=\"multipass\"><a href=\"#multipass\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>MultiPass</h3>\n<p>Let's begin with everyone's favorite Raspberry Pi tool, PiHole. We all know what this is and we all love it. We are going to be setting ours up with cloudfared for DOH and DOT DNS traffic also. Log into Rancher and create a new project called Networking. Well, you can name it whatever you'd like but mine is going to be networking. Then I am going to create a namespace called pihole.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 728' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-24506b081693fe181c23a5d03a35df62'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-24506b081693fe181c23a5d03a35df62)' width='2560' height='728' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAASCAYAAADrL9giAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEtUlEQVR42tVYS28bVRj1LygktmOPPR7P0/P0%2bO1xkqZJqsYJTRDJgoakiIdBQmqRqNiwYMkCCQQSEhIbNvwFdgiJBX/scL5rT%2bK0kboj7uLomzuex73nnu9837gQx134yQDW5DHS7giOF6FWt1DXbegNBx2e6w8mRIbhaFNFxw3RND3YTsBrzZVCXbeg1ZpwvRCm1ULDcJB2hojbfbitBLYboVwx8PXvzzD77kMUrKYNy3ShGR7qmg6tUkN1Q4NG6PUmjKbHh7iMc8gD9YZ99TKBjFcNlu2r%2bcqxzQ0zDRKzXoRWLKF07x52DvvYebyDQjCZIt46gh5P0GhvK1TCCcpEvdWD7yeIqJIgTBk7iJPe4pjngrZ6yTIJOSl3CbVBVHBd5kMVV8sVODtnGL/4Ddmzn7H51a/w3/8WzWaIgnvyBbpPXiA6%2b5J4juj0OfSDGarTz6Fnx4ijNobjLSX9wXAT4%2bw%2bev0M2eQ%2b02OoXlbVDGxUdIVKtXF38ifyuVRLG0RFkVAtleG/M8PDn/7Bo%2b//xPTHv5B98we8qItCnfkScierlTrefquItbUyimsbKBV5M3/z%2bdtgsIluL0OLakjaA/T7E3S7Y5KyqcgQVYyzHYW0M1K7kKfI/7Xw/Dhhrg9G20iOZwiPPoa%2bSNs601mlN9cp0AiXflewaBRh2EaDTK2vV1AqaVeokMnd3SmePv0M5%2bcfYX//EGdnH%2bDy8lNcXHyizp%2benmNv71CNLy9nODp6786kXyMOpyd4cjHD9Jd/sfvD3zDsEIbyLefaIxY%2b5noxCjbNIgiSea5HnRtE1KgAuVAYlFzPx03Je2Gc49t2RFz4rnDlASYrVNN/pULknjWvFFSAw1ImCohpcCHNrVyuoVisKgLynBKVyHVCjCxartN4vljUbigmhzzjrnA1D6awwtK8Njbq8LjoCmOJ1yoFuCwRsvMi9%2bXF5wrwPFEHewW/o6LrJnN47cX5NwBB75Wx10oJEiClTNJgjcaXLz6Pssstf26CYnZ9QpqLJnsDg72BxfxKkjGRrTTSbIrO9gnxLtKtY6SjRzTubE6AyY6u1YrU7i%2bboJBQZUnLm6CmxUU3nfnY9FWs0VlNHttORBKjeVxFeCkc7rygFQ3hUs2yeYoA2X1ph4WIeV5fq0DGasGWCzsO6J502wbHfo/lpUUzMVeuFb4VNQM1raFiHKeqhddohJ54gLh%2bbnKGYV97wIKAVku6vgHRV9EPpCvss3IsIVxRLOYWticI021EnW3GLUQcixcoBYjsJf8FL6eAdFQu06PN5iKOe0hTfjRZvjLEOB7RPPmREQ/V8Uoims8tGT5Ee3KIJDtENJ4i6e8hjEZzAl4uYcspICVQ9feUvuE6bDRYaykpnfmuG%2b6isXBW8mPoJhxV%2b%2bUrNgg7NHJfzV%2bVwdvq%2bLIJmlYAizd6cQKTfmE5MZxwqEzENFkR3gRI1SIJUvJFzbJwgx72WgKkNwiCDjqdMW%2bklNpDun0ImwwKAQHrqZSZOB6vLFSZ7j1Ae7CvpB91HyDp7tDPRvS35PUEOG6AKOmqz9%2bQDZP8ESLI/xeQpiIMB0R/EVcNNO/%2bLuLRAeLxARJ6QExCAv4mCv4PtfFtdLdXHb4AAAAASUVORK5CYII=' /%3e%3c/svg%3e\" width=\"2560\" alt=\"namespace and project creation\" data-srcset=\"/assets/static/pihole-project-rancher.82a2fbd.8ac1259a16ede379f303fd3678a61fa8.png 480w, /assets/static/pihole-project-rancher.cbab2cf.8ac1259a16ede379f303fd3678a61fa8.png 1024w, /assets/static/pihole-project-rancher.2665e34.8ac1259a16ede379f303fd3678a61fa8.png 1920w, /assets/static/pihole-project-rancher.42db587.8ac1259a16ede379f303fd3678a61fa8.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/pihole-project-rancher.42db587.8ac1259a16ede379f303fd3678a61fa8.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/pihole-project-rancher.42db587.8ac1259a16ede379f303fd3678a61fa8.png\" width=\"2560\" alt=\"namespace and project creation\"></noscript></p>\n<p>Now that we have project and namespace we need to add some repos into Helm on Rancher. Click on Apps &#x26; Marketplace then Repositories. Now we click create. Here we add in our pihole repo. I'm going with one that was made specifically for k3s.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 1095' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-e1d8b8b2b23dfe1ae9f4dfa3f48ea61a'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-e1d8b8b2b23dfe1ae9f4dfa3f48ea61a)' width='2560' height='1095' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAbCAYAAADMIInqAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEt0lEQVR42t1Yy3IbRRTVJ8R6jub9fmv0HEmJZEMwMRRVIVXZUFCsIItUqKKA4geyY8kun8GWvzvc2%2bMZj%2bXIJgjJchbH3a4ZzfQ9fe%2b5p6cRRQP48RjW4kvEyQi2E0BWTCiqBVWzMcimGI5ygdF4jmw4g%2bOE0A2X7g0hq8W9BcwjgIW%2bbMD1YpimV8QwmCCKh2K9luWj01Hw67vX%2bOHt92hwMA7drLoD2HYATXfEA5gEntu2D4fAo0vk8D38Er4uiFKK4FXVFi87Fli0Tt4kBpPBMIgQw/Ag9XWcf/sZTr8%2bLQhw3RDtZhfNZg%2btllShL%2btQ/RHUYCKg%2bGP40QjzxQqL5Rqr9VMEaQor9KHbbpU5x4Bygxi8oeWmlmtsnyjotFQ0OCXiOBOsnZx00W73CzABxJQbTxFN1giHyyJLvITKYYaU0iodUOl4AczAg2Y6xQtU89rLjwXK5v%2baJdBw3QhRlBEJQ6r3iUh7zoR2W4ZMrDFBHmUIQ1WLB3EKMTk8cgmoeyoBXss%2bwZnQ6EsqwiCBQuneojLgnW9xKdC811VgEgEBXbdtj%2brKE%2bM2WFZxzwfBunouE8m1y2Ls%2bckNElTtaixJKsX6Q1D/TUM2AkRZjnS8hBuO0JIMtCUTnT7VkeaKxaXpkLIkvZOAXaFSSmq6W4gVQTc8IWLF3N2YU9lpzk46IQiIXv6M6Xe/Y/jNb7Cfv0Hv2Y/oX7yC/NUbGKsXkChDepImROS2Vve/1erGAq8v2r4237XERAlowRjx7AwhCV2SfwIrydHWQnStFIodI0ky5PMnMKkNitq/VNQ6tqm/TPogq/8em%2bp9CDQsw0bghYiCGAEJXafVReukQ22iA6mnIhivkS9PEYYDoQeWTb6BhJNr1XEimsciHett5jZSjg0NDsQnweHd7ZLolW2wReBAzJDaXcZOkF1g4QZn%2bQqTyZLmC4F0MIUfpMJthdEQSTom1xVVJBxjW6wygIPnVsgeoDRAggBhhAwYui0sJNvK0vVtGg6upyuB8iqhOiZnuA2XTjASARf9v18RIJH4%2bcGAnN8a48kCQzoHjCdzYYD4jMDgOZsiDrheBrsK4L5dYtUFOPgRHXSYCJm9QC0DuCw4sKL2g8pTswYwODNKiLa0gym5twzQ6A%2bntzgI0fxGCdC1UuzqB6X37V7RWv5bO2KS%2bfmHzoQGpz3X/6NHnRslwKLI4jaZLkUGlPZxHwuxL4/YhxRO0QWqw08t8LoGmCIDQnEGUC4Fbx/YrM%2bDtcFNAupE9MgHJNkMM/IBqulD0d2D7MohSbiVAJEB2RPYq%2bdwTl/Amj7d%2bwKPKgOYAM1JoPtDAc1N72WR90oAfxPgURIHIr0g4CMi4W4NSEeYTnLMpgsEfixOh%2bXHx4%2bBhNsJoF230zmC5QXCxxdw83MYg8dQyPQ8hOC3rpG/I5RfhO4qASPOYc4%2bJ5zDyp/BHJ8RAf7RE3DDT1D5irGvoddsoXvShEzZfCcB4mMH/ahC7aj7UEhQTTJxJOI8Gtkas5/%2bxOKXd7DmX6BR/wxeoVYCSu1jxX22q50IsCLo4ZRGOtVOz7F6%2bxc%2b/eNvOGcvt2cAQyoJeE%2bwD7YEuKt1eui1eyKj/wFGVil%2buGYGVgAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"2560\" alt=\"pihole repo\" data-srcset=\"/assets/static/pihole-repo-rancher.82a2fbd.7e1ced9b9169def7393ae16d605f7f3c.png 480w, /assets/static/pihole-repo-rancher.cbab2cf.7e1ced9b9169def7393ae16d605f7f3c.png 1024w, /assets/static/pihole-repo-rancher.2665e34.7e1ced9b9169def7393ae16d605f7f3c.png 1920w, /assets/static/pihole-repo-rancher.42db587.7e1ced9b9169def7393ae16d605f7f3c.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/pihole-repo-rancher.42db587.7e1ced9b9169def7393ae16d605f7f3c.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/pihole-repo-rancher.42db587.7e1ced9b9169def7393ae16d605f7f3c.png\" width=\"2560\" alt=\"pihole repo\"></noscript></p>\n<p>Before we install we need to setup a couple of things. First, we need to make sure we are in the pihole namespace in Rancher. We do this by selecting it in the top.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 928 114' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-315c2d035505d56e5d4603185de93c43'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-315c2d035505d56e5d4603185de93c43)' width='928' height='114' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAICAYAAABJYvnfAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC9klEQVR42sVU2VITQRTNF4hClsns%2b2TCTMjCTPagKBYqoUoFil1RKMDlDbcnS6p89sV3P8J/8C/8luPtnoRFXxKKKh9O3e6Z23c593SnGs0W/g/aaDSaqBPYuj4CGs3OOVqdy/txQGfr9QbPn8oJKoS8BlHSkRc1WqtIvjGrQBB1CJLB99eJXE6GqLmwKj3Y5Q6cSpdAa24T2OUu39uDtVlqXQusmTa3rLeUrJi8oHRGRCYrcSIk2UjASElnkJ9KQxJV/o2RJMk69xuSduY/KiinSPHMoA6/0oJhuNAMD4pqQyer6WzvwrR9GGaB/7PsIgzLh6xaUDQbquZw/7FA5yTFgkCD9cotaIUqU4CC2aiF1bVNLC8/gWl5yLPmqEB3YRvT6x8R7n5GoX9EyW243vRZIwoV47jJ/hJxIyBPpBvTEbwwgkBq8AoBybNLzTsoTs9Q3CJXoKpZVFOBF22YHh%2bWTuT05u4iS%2beGuUcBz0kxin4Aw69CZQSwyS8%2b6OPL6VecnHygQkJ%2bJSRJg15qo/XtF3o/fsOZX6cACnZ2X2Br6xk2Nnfwcv8Qz/f2eVHjqoDFMoMYFhUShhW8e/8Jx6/eYntnDwcHxzg8ek1FG6jWGljqP%2bYKNUkBrDaLlNGnYWWIAKbgUfIxvyyR2Ju7h5Wna3DCGKpXGSqgiZXVDZ6IMcRlTdPOTdxA%2bc13xKc/k%2btARUdxG93ePJ/Awv2HiOudK10DFssgApxiFQ6prlaNoeukMJo8g0%2bDUJgvi02Q6dqx/4IgQ1WImEpE74jElSrmR4GS%2bBIyU1k4QUQKqCHFimFMTtzM4NZk7qyZoaRlw4dincuevRNsGgyT6TzfX5ThqASwgjS/Brfag%2b6WoDolGIUKdK%2bcwJ2BSeqwhiCi2DfFDjgks0hnQqj2mGBnqB/28EpWiBQrWlaS%2bzyUE29k0IxIhIiDBzDxNf/BuPc/eUxVWG6A6HYfs3OPyC4hYvYCZv9CNPQjxAN7FcR3%2bqh1FhGENfwBbVz3S0i2eL0AAAAASUVORK5CYII=' /%3e%3c/svg%3e\" width=\"928\" alt=\"pihole namespace\" data-srcset=\"/assets/static/pihole-namespace.82a2fbd.7b8408bbdc52556f30402398856d6a05.png 480w, /assets/static/pihole-namespace.a9e2085.7b8408bbdc52556f30402398856d6a05.png 928w\" data-sizes=\"(max-width: 928px) 100vw, 928px\" data-src=\"/assets/static/pihole-namespace.a9e2085.7b8408bbdc52556f30402398856d6a05.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/pihole-namespace.a9e2085.7b8408bbdc52556f30402398856d6a05.png\" width=\"928\" alt=\"pihole namespace\"></noscript></p>\n<p>Now we need to create two things, our secrets file for our admin password and our persistent volume. The both are created in the Storage section. We create a secret just like we did for S3, this time though we just need one key value pair of password and the password value. If you don't remember exactly how to do that, it's Opaque secret, name it whatever you'd like, and input the key of password and the value of what you want your password to be. Then save.</p>\n<p>Next, we need to create our persistent volume. In the Storage section we just need to select PersistentVolumeClaims then click Create. Here we have a few options, the name of our claim, the storage class, and the size. I'm naming mine pihole, the class is longhorn, and the size is 500Mi. </p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 717' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-9157f34bfbb2d9a93fd2e32bb09c8dff'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-9157f34bfbb2d9a93fd2e32bb09c8dff)' width='2560' height='717' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAASCAYAAADrL9giAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEuElEQVR42tVXyW7bVhTVvmhszaQ4U5QoDposS/GAxG6QDgHSuBlatEgKFCjQRbtru%2by3dFOgf1X0U07vuRJlynDqxDJqd3Fw%2bchH8t3zzh1eJUmGCJMpwvljpOkQnt9Dx/IVjtvFZLrAeDLHdO8%2b9mYHeh12B3C9CEEY6zzLDhTFe7cNs%2bPp2nzxxXZCxIMh8uEe/KCPMIpR2zHx9S8v8evvP6ISxznCeAh3MEMUDdTpjnzAWhHQFWfDbiw21uehfNgT5x03hCvPl44HayL4w9sG18E102FuVDdKlARurh/20W65ePT8EV78dIYKnQqCHmq7DdTrhqLRMNFsdpZE%2bDEsr38OGdtibVqB4/eVlKiXLskrKeI2UaiB11QEUdwjSY2aheo9kwQkSJIRDMNBtdpak0AC%2bJKXLuDlB/CGR/Cy%2b/BGx2KXYzc/RJjNMZ8f4uT0sTJtkLQ7FA5lIspj2xG1ioolBDJk2Vjifyx2ItL3UKu10aICOFEZ9VXurlcgKlkJBw2Jrny0q%2bwW998Xjrv8JqVajK/Cdf9FcK2Vfj8FE%2bF4PAPJoPypgFbLUlVkkjwOjk4Qi0o8iR%2bfsUVbQsB7/RzD0UyJNFcqeF9wQX4QI0kn6Mn3SOi/OV/E%2b3WhBGiSkxjmrtPxwjIEDNPFQByf7C2WTl5wfAPynUSc5/xtkuFSAX1VwVVw3GjrhFlhqeDOeyJpXjPxaQiIAhgCJKFJNYg1BZ2Or3OKcsP7BVptW%2b1NlDFNWit7cdy5kNS2QYUsMAnm%2bVR3kOWvXjeXBIgEg9ERIi2Bidb/8svcLd4LpNxQSUVf8H9CxTJsZIMMeZLDbHdw74MdKQ9VmE0DNieFObxI0BupZEhMW3aaIUK5Hx%2bfYr44wr5Ugpk0SkW2fVsl2CZeb7JPWBOQPfkOo8%2b/x/SLHzD49FvEn7yBd/oVrJNv4IwfolFtom74aJgBaqsSWeSKvjQX%2b%2bI8y19bEuZlyU9/aocbCetdSxYVRpKJokO9iR6BTRzXzPVW4o%2b%2bxPjJG0QnLxAcn6H78Dmcg6fwHryEI7W%2bUWNvIIlRHGaFWEPue9IHpNMjLZ/jyQKj8b62nLRZvifd1whpNhUHpMzKnL50nGWFXNXIMNPP9g%2b1/V7v4LrcXhehJk8NZxIQelJ6HIn73Tp2P9xFdQWz2YZlOmiI1JkTys4X3SJ7BHaAvX6mztJBli8ilmv%2b7LJkdZUK1gQEA/hRhrCXKzpOBFOcoL0OTLt7/r50sx35T4WLp0SrusMddZi2Lg5qBVACjA3HC1ucAcqZ27TOs/ZWrazA66YYSJix8hiGq2uql8LwcpgrlMby3s5uUxP1s7NXUtVsaetjTfLSCGUYSQNDOZSdbVxCwEUFXCXlbTO07Umtl/OGqTsvu%2bb2YF2BjV13N3ffFUVRna2GAdOwFHoY4omQTDsi2fJZoFzvL8N/cazd/I/3dqzmKRE8tNGK4%2bsDnDhvipLsZIH449cKb/wAFWZzHoKIWinRkQQq4C6c7N719Gexde5merS3xdphCrc/gZvsw03nQpKL9NXP%2bOyPv/D0z7%2bRv/4NlY3MfiHOCwLufENTriyqAIZDpIQsr1dgFRAlKCECEvQPbxQisObeMbIAAAAASUVORK5CYII=' /%3e%3c/svg%3e\" width=\"2560\" alt=\"persistent volume\" data-srcset=\"/assets/static/pihole-pvc-setup.82a2fbd.8c252a80b853c60c5c565cf9d0905ea2.png 480w, /assets/static/pihole-pvc-setup.cbab2cf.8c252a80b853c60c5c565cf9d0905ea2.png 1024w, /assets/static/pihole-pvc-setup.2665e34.8c252a80b853c60c5c565cf9d0905ea2.png 1920w, /assets/static/pihole-pvc-setup.42db587.8c252a80b853c60c5c565cf9d0905ea2.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/pihole-pvc-setup.42db587.8c252a80b853c60c5c565cf9d0905ea2.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/pihole-pvc-setup.42db587.8c252a80b853c60c5c565cf9d0905ea2.png\" width=\"2560\" alt=\"persistent volume\"></noscript></p>\n<p>We can actually go check this volume out in Longhorn too. We can see what nodes it has been replicated to and all the details.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 725' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-5f4d86b3ece7dfa667fc530832f9d0cc'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-5f4d86b3ece7dfa667fc530832f9d0cc)' width='2560' height='725' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAASCAYAAADrL9giAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEuklEQVR42tVYW4/aRhTm//%2bL9qWt0qoPrdSHKmrVKG2yabguZFlYYJfbYsB3G9vAnn7f4KFer03IqpWSkY7mwvGZM9%2b5zVAZTabSH93KcDyRu9kc/Vh6w6F0b27Qj9RY0WCo%2bPpYG4H3qn%2bjqNO9lunCkKVli2FaXwQtSGtTDOhcuV%2btZWYYMl%2bu5DBeqgNN7hdqrPsZ1rjOMXk1z3h%2br4SubOeLIcv1xPZ8pXdliQVFQENROl/l%2bkdkPRZoZKyv5Rjm5%2bsRXhBIFMfS/nAlFReTMIqwkKg%2b3ICi%2bDD%2bRNpAKOXZnicbyFAUP0/W/008b6vdkUqUJDKbzWQ6mcj47k4GiP04juS5bbvbSYAN1quV9Ho9Wa/X8rm2zhU8gEg8PDzIDorv93tFnD%2bH2BbLpbh%2boMZ67b9unyq3TFcVAnGyFRJdP4LlfN%2bHB8SPPiwTkhfIvgurMwTY5vO58qq7EzQajcR1XWUAzk/x397eyhhVikaybfsw/wg/dcgDp/uOBiBCrNquL2EYiuM4qi9Dr8gCxzn6HkLIQYZlazab8ufbC6nW6tJoNOTy8lLa7baiVqslnU5H6vW6LOE12%2b1W3l5cyJt37xV/s9k48pL0t/yOYPFgr17/JX9X61Kr1dR6lpeyuXZ9fX0uAB4OvhEHve%2bH4icbsRP/LPfLA6A9oArFvvr2hfz88g95X2uoQxEITQSoWq0qAGjVl7/9Ll9/94P8%2buqN1BuPeTXxUMwzi8VCvvn%2bR3nx0y/y%2bh0AKJBNcPMAZA35LwDIA5aDgwcbcWE9x3HFDly5D03xfACDmDZ8S8zYPekBOgS0B9ANO50P0oY1bgBMv99/Qt1uV7kzPYA8l7DgFZJTET%2bTKtfpAaa5Vt%2b2YO0iuSQenjqUAZDmgETlAALgeoF4ngvhpjhQKtklKhxClDY/CiXCvAwAvWYDPJbCPF92cx7gY56leXVifvqblPKfMlCpB5i2iwvCRkxcciwcgj0T47kZWK9TnheET4BhbmHCI02n0%2bOhSqsJXHyIKziJBilNxFgnoEx4lE2Le2kIFuWu7HzNq3AM1%2bOFhdY3LdyS4O7b3f5QFdISeU4S1Gu8%2bOQB0L8l8DZWmVPlKSub3sfKdC4/D14GbJE%2b1PPoAYxbui8VzLpo/uNTdZYtygCgleHBJ7hoaQsNBgNZ4aJUdhiWRVpUW5U917TMvC7aW1gitYfpUp4NiSf7wNhHAFgGGQJ%2bECgkA/QJvOOcO0AZAFyj4hpUKsOegBTeIrEfQ4V769gnb1HOYCMf5fOwOreQv7RM5%2bYpAIlSmiFAEFgJmJVZmih8m4Jw7u0sGwK0CGsyszU9IEv8jZalN%2biLEDM3%2bZnpi/hpZXoQeakjaz2JcvL82tN4X8gbak9daRwCQCvHaQi4qP8B7gKui0SIfECiNxDhaLORBH3MhwTHBA5j9lmQ%2bLbw04sUlVQEOXwT5InJjW8GyqG1dfWxLLOUn8RDMD9YKb9ZxJv29KiyxmpVobJEYqWyvycm7wCwyJoA4KnLfoWNDChq8qkLoWqMjY3l6sCHTWh5lUzVa9BX84QumRITayHh4ASN/Jwf%2bPel/PyN%2bzB0Nf/2JP8ufd1m6fBy5f8C/wBWg0iNTehRfwAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"2560\" alt=\"longhorn pihole pvc details\" data-srcset=\"/assets/static/longhorn-pvc-pihole-details.82a2fbd.50ea86500824c9c46012842a8dd7ebcf.png 480w, /assets/static/longhorn-pvc-pihole-details.cbab2cf.50ea86500824c9c46012842a8dd7ebcf.png 1024w, /assets/static/longhorn-pvc-pihole-details.2665e34.50ea86500824c9c46012842a8dd7ebcf.png 1920w, /assets/static/longhorn-pvc-pihole-details.42db587.50ea86500824c9c46012842a8dd7ebcf.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/longhorn-pvc-pihole-details.42db587.50ea86500824c9c46012842a8dd7ebcf.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/longhorn-pvc-pihole-details.42db587.50ea86500824c9c46012842a8dd7ebcf.png\" width=\"2560\" alt=\"longhorn pihole pvc details\"></noscript></p>\n<p>With those two things setup we can now go back to our pihole namespace and click Apps &#x26; Marketplace, click on charts and scroll down until we see PiHole. Select it and click install. Here we are prompted for a namespace and if it doesn't say pihole we can change it one last time.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 1179' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-1656f976cb2c8f39ae5028d2c1f16310'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-1656f976cb2c8f39ae5028d2c1f16310)' width='2560' height='1179' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAdCAYAAAAaeWr3AAAACXBIWXMAAAsTAAALEwEAmpwYAAAE00lEQVR42u1ZS3PbVBT2X0hsxXo/radtWUr8Tpw0MI2blIFpy2PJql10smKABdOBHaxZ0A0MazYMK34JP%2bjjnCtbtUMmbbDKtMWLb87V8dWVzndeV9e1OO4iSHK4k/vopgfwWhFUzYamO9ANF3k%2bRL8/wUF/jMFgiv2DMc2JYdm%2bkDyPwfdUgsV6m0BRLfhBG7YTCBt6WR/tTi5sc9wQjYaKr3%2b9xJMfPketRUZ4fgLVCmGYHjR6CUUxxSIG3dwk2VCscnFekLF8YZ63qq8CmmZtvAY7yLRawiYmgg0vrlvincdnE/RPhgUBQdiG1FCws9tEva6gTuOGpEKSDHzz3Zf44/ef0e0OKApGiChikqRHkTAS0ZBRhLheVBKxCYrIc2HGfWhMhNC7t15HN9wr6zplVDOYEKmuk806apZhIwpimDp5eqdBkFAXsoEdIuH5s2/x1/OfkA6PcEAGtyha2Ojp4R2MxjMBZnv1Af%2beAPK8m8DZP4VBUtPtaiNrIdnhluOLZ9aC/AjJ4A7hFOn0LqxkiLqVYM9NoTqJuMGg8JFlHXtNnaQh0KRxk3QsOWVUioCXQVHNUhYgg9ljJdhgDzqFqb5Ix1JfGRyYtLYhosSmFPjoEulnX8D%2b4Cnks8dQ50%2bgzB9DOX8KbfIh7CiH3x0KBD1KgWyMIB0i7BWSdUKmozX4Ys6onBOKeycI6f44nwjwWmaYwQh6V5Beo6sSxfqa5aOm6R6iJEMn7aMVdFCXNAGZvWMFCKYXOLz4FJN7jzCeP8Th%2bScY3n0gxuP5o4V8KHTT848xIR1L/m15D8sJyezkPtrTM/SOL5DOzgWcfAY7O1rBbAVH14D0eRU4pnSLUeOQbFNRS5JUhMjuzh4adVmAw99Opwj3jxAR4v6McCyuGcngBNHBTCDID8sxz%2bPfYkqteHiKZPSekHZ3DINSbBUW6W6F9hBm0q8Euh2gxjkRxymiqIN2O4NNBW13V6YOoIp8salYBGFH9FXL5jZCNcHyRHsR4wXMKzpe3LRD6usupD2uH1Q7qJ3Kqi2iq4Ty6mhyrTFaRcHkuqJtCqoBnhciXrS2kAxtUAuscwSQ5OIWkf70/TmlyD5c2kjYNN%2b5EdRzaZ6b7Ive22xqRGhTrFlnuQF2qUPJRCgXySq6jugCrkt5Tt5lj7PRJQEEZpm9WrQQp/Cw9QrgedwazQIcDZpVDbguvdgzVEAAe90lT7GXVr3Pcrm5WT7sttvaKl7wn7DX3mdjAhzKcd4NssE7XABXokCWzY0eVNn3wRqcaiPA92Nk2UCQwHvwtQhQzEofVhWqfB/RBSzKW44EHt%2bUAu8iapz7HPqMZR1YEtCkLe87T8DS4LUOUNaA/yEB60VwS8CWgC0BWwK2BGwJeBkBr3fv/wYQoKjWyl78xbf022x4SYD4Tr%2bKlZ2gYbXEgUgYdQkpjQvJ1zz2/fZGX4z/OdhwwytwUwQwOALEHwtEAp8U8fG37YQLBKQLSBdUenT92sER3diDXJegKgZqkqQJT3e7uTgV6nRy8CEJRwAzpjsRdD%2bF7rUFa%2bvp8HalgKqa0FtdDC5/xPSrX%2bCO7qG2POdnj0vi3yC1PB2S6XPYcGMYQQaDbuRjZO0ag9/4sF%2bmJ3lc93uYPvsNJ9//CW/2AH8DCSrsY/Taz34AAAAASUVORK5CYII=' /%3e%3c/svg%3e\" width=\"2560\" alt=\"select namespace\" data-srcset=\"/assets/static/rancher-pihole-1.82a2fbd.49d79aea24b95dcf1c5f131b34f4c5bd.png 480w, /assets/static/rancher-pihole-1.cbab2cf.49d79aea24b95dcf1c5f131b34f4c5bd.png 1024w, /assets/static/rancher-pihole-1.2665e34.49d79aea24b95dcf1c5f131b34f4c5bd.png 1920w, /assets/static/rancher-pihole-1.42db587.49d79aea24b95dcf1c5f131b34f4c5bd.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/rancher-pihole-1.42db587.49d79aea24b95dcf1c5f131b34f4c5bd.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/rancher-pihole-1.42db587.49d79aea24b95dcf1c5f131b34f4c5bd.png\" width=\"2560\" alt=\"select namespace\"></noscript></p>\n<p>Once we click next we are given a yaml file of values that we need to configure based on our needs. This is a large file so I'm going to just tell you the parts we need to change. From the top to the bottom here are my changes:</p>\n<ul>\n<li>DNS1: 192.168.1.1</li>\n<li>DNS2: 1.1.1.1</li>\n<li>existingSecret: 'pihole' (this is the secret we setup earlier)</li>\n<li>doh enabled to true</li>\n<li>ingress enabled to true</li>\n<li>ingress hosts changed from -chart-example.local to pi.hole (you can use whatever you'd like)</li>\n<li>add under the line PersistentVolumeClaim add existingClaim: \"pihole\" (make sure to use two spaces before for yaml syntax and the name of your volume you created)</li>\n<li>set nameservers again where they are listed</li>\n<li>under service DNS I specify LoadBalancerIP: '' to one of the IP address in MetalLB pool (192.168.1.201 for me)</li>\n<li>change NodePort to LoadBalancer</li>\n</ul>\n<p>That's everything I have modified. Once your configuration is how you'd like it, click install. To note, if you want to use DOH, you must use ClusterIP for the web services. If you don't, you will run into issues with Rancher ports. Also, if you cannot use HostPort with DNS for DOH to work.</p>\n<p>We can view progress of deployment here and shortly it will be up. Once things are up, we can check on our ingresses. We will need to create another entry in our DNS or our local hosts file.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 572' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-4ef6e758e844ec3e9eb7586552a66f57'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-4ef6e758e844ec3e9eb7586552a66f57)' width='2560' height='572' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAOCAYAAACfOxrCAAAACXBIWXMAAAsTAAALEwEAmpwYAAADlElEQVR42t1W22pTQRQ9f6BNcpJzv5%2bcW25NmjZaWrQKWioIXqBYUKlIfSioCH6BDz4Ivvjon/jkly33njMTQzUYsMXiw2ImcyYze6%2b999qj5XkPSTFEsHUXvf4YUZzDsgPYTgjHjTCebKE/GMMPUrheTGsxfYvEPv7Ney8T2G7T8pGkpbCZfegPJiirobA5jHLobRfvvp7ixYen0LrdChkR4HUJ7KA8wCKwg55fH8IHM3itXk8kIdGlRBhl0sYEcVIgJuf9oAvX9tC6chU7%2b2Ns35lBi2hjRewEfoR224auW2g2DbQIzGiSFsgoS/KiLw5ipxUZNaIzvy8HFrNCBJQDqxtIdh9g9voLBs8%2bwu7dgBZGXaSULlneR1kOBXuCgJYp/jgYTjCb7WCycY3SaCTWDNNDx3DR7jhoG45YO3vpZSiFRZtsKl2jpSM/eIlbn79j79M3pDcfUwYECbIuRZkinSYZGms6Gld1NBttmORclg8wHs8wGm1incaN6Taq3hjD0RRTmm9sXEeSlHMSlkXhj8ZeEBEc0MVStS0PRpuC27HoTh%2baHVXIhzMUoxmG0x2UNGaDTRg%2biaHfxe7ubTx5cozDw2eE5zg6Osbe3j4O7j0Qc14brW%2bJjOALfheFVdL1okqBbVJiKAiQoxJ0rXz0FpOj98gfvoF59wT2/ivCCayDU3jb90k0fCEe6hBPCqA60OVDZZ2pLFCiOa%2b/JRDfaI/QFTuU64GE/9fg811ps7JnToQkSHPjHqr1ayLyDMPP0DQj6E4KLypgUGQDcj4KM6ytUVmYLgoSRV5XWsFQ4sldJMt6KEg0O6QR6vsysPCWtNcmY5vNjhDflhr/8N9VwOrP9vA9jbWO8IVtZFuZJM0ih0pyKPBj6PJyrv8WwXEoOpQmbhAjyLpwPGKRVN%2bNSqH%2bZ%2buNGedMSam1rqwBnDFhTijgUMm5QSbmNs3PTRAX5tzJuEXWpUAlkNBCUQx%2btr8F9ur0TOCHCaI8g0skOfQu4DeD4yW/9F52mi%2boeuur92w6x0sH9TskruAnlZyX5/YmWBRB7nYMYT%2btawF1ASaAU4RTnB2fvwMW25vJDEq1JiW1lwiXapMrC5U8r4aqX29%2b93nDMKV9MiMoA3LxEOJR1YYiYd7fHeVsnbL1WrhS/12lBFZ5zJz/%2b0CKoElsuG4olNISQrRAgIzkRbapfw2t0eiAwenPo6p/JoB7%2b/9OwA%2bi98dKeeIGBwAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"2560\" alt=\"pihole ingress page\" data-srcset=\"/assets/static/pihole-ingress-page.82a2fbd.58fd172db11e167ea791f5e2d3f523d7.png 480w, /assets/static/pihole-ingress-page.cbab2cf.58fd172db11e167ea791f5e2d3f523d7.png 1024w, /assets/static/pihole-ingress-page.2665e34.58fd172db11e167ea791f5e2d3f523d7.png 1920w, /assets/static/pihole-ingress-page.42db587.58fd172db11e167ea791f5e2d3f523d7.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/pihole-ingress-page.42db587.58fd172db11e167ea791f5e2d3f523d7.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/pihole-ingress-page.42db587.58fd172db11e167ea791f5e2d3f523d7.png\" width=\"2560\" alt=\"pihole ingress page\"></noscript></p>\n<p>We can view more information if we click through here. Our traefik IP is the same as it was for our Rancher deployment so we need to point our DNS entry to it. In my case it is 192.168.1.200. Once setup we can browse to our pihole instance and login with the password specified in our secrets.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 1775' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-d33d4a3d0e85f738ce053d8c87e35c98'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-d33d4a3d0e85f738ce053d8c87e35c98)' width='2560' height='1775' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAsCAYAAADVX77/AAAACXBIWXMAAAsTAAALEwEAmpwYAAANYElEQVR42u1a%2b3McxbVeFyAbA5GxsY0s23rs7LxnZ3ZnZnfnsavVSqu3ZOQXOEBiC9tYBhcGYjAY2xDZQBJDQmKKR9nBJNyQqlTdqpCQVFLcR6VS%2bSGVH/IffTmnZ3e1EorBMje3uL4/fHt6Hj3d5%2bvT55zu3pTrusjn8/B9H0EQoFgswHXz4l7zGUvLsmAYBkyTYSZoXf8rYV4X3EfP81AplzEzM4Pp6WnMMGamqTyFvXv3Yv%2b%2bfdizZw9mZ2eRYgUTAgoIwhDFUkAKe8jlcsg7DsEWH7SyNgxuhIjQqRFN00XZMP81MBtStK3r0HVDgMsCWgJV1ZC1bRSKRYyOjmF8fBwj4xMYJYyMjmJicgrTRAyTMzU1hVQmk4EkSchoJmTThmxkoZgO9GIVejAEPR6FYntQ6Z6WzYtnWbcILyiLspbNQb0erBw0i8v5Lw1%2bn7%2b7HDrB8UtwSxFyfoBcIYQfVui6jEI0QKiiVB4U124pFs8zOvXX05HNG4QSbK%2bEjGoInRmCAAHFhKbmoBgOkWBDyYfQoxEYgzNQnQJkPSFG0iw49JGoUoNEdRTdFpAbMilnIWtZITMNyLoFheoq%2biJkrR1mIhvvS/SdNHWepUQy3ZBZL0S%2bVElkUEVQHUGpMoSoNopoaBzl%2bgRKdC%2bsjaFI93eaOQyRfrWMTIMaC3K4LTHodD8lyzLktIyMq2NH1YLEpk6jYNo02jp1StWJFFsoLzek5ZagugWohSI0Aku9UFosFwNYQQSzFMIu0mgVIhjUabU0AI2gNmCQAlY4CJMR1QRs6qBD77vFEk1Hj0w5QbEh/QLJkk/PCgI5mrqmF9DoUpn67BByjkdTl/wXSZ/66fshCmwtZLkuvWvQfVaedU/JCinfK6En0lF4vgvqoIx8cRBju2aJ5RL6VSKlOYo0RTSyECOOcf9cDduODGPb4SF0H6lj86EB3P9YDV10f8NDAdbuzuOOAx52TIbwKqPYevI1dJ97B10v/gTdL13GtjOX0fncj9Dx9CWse%2bp7WDf/Xdzx7A%2bxZe55%2bETOD44q%2bNVpCb84JeOXz6v4%2bDlZ4KNnenDl2Ca8ffg%2bfPjERrz52E545RqOxwEuDwd4YzjCpWoRbw6H%2bGE9wuuDJZxzNZzNKThPOOebKNI0SjctQKGfXiIh2pnGpx134uSmLXBiHSOTwxiieTVUrWGgPo5oYEj4AJXMUCmHWH8kwsb5Qaw/HOKeo2WSETbR9eYjdO9ggNS0htR%2bE5tnaGQq4%2bh88W10XvwZ7l24hq2v/RxbCOvOX0HqzPtInbyE1NGXkXr6Tdxz7Dy8YgUfnOjGf73cjd%2bf6cIfz%2b3AH85247NX%2bvGLp7bigyPrcOXwelw7shbXjm9EoTyA75Ty%2bCDO4v2qi/fKObxfIZQdXIocLGT7sWD24BWjh8pphF4BfURAYgFEQJpgZRRc3bABx7t2kDMxsGtmFAPDExgem8QgETAwNAqNzEs3cpCjAD1PTWDL/BCmL51E/bV5KKcopOwhpWcIeyys2WUitdfE/VMFZMuj6Dn/Doav/hZdFz5A6pm3kDp1Gann38aaUz9G6vgFrDl6Dqn5BXTOnSbzL%2bPq0yo%2bW5Dx32/V8ed3ZvD78xJ%2bOX87fvzonaT83fjo%2bN348PH1ePfoZvhxBaeqMT498Riu7RnD1ckqPv7WPvz6qaN41dexQIp/z5FwwerDy3aGCCgKnYUFCAdIbOyUNQohBpm8if4shRkKgxo5EJ2U5gigUHRI0/NMxkAfzcH8uYcx86Nn8PC7L2HuyisIF%2baQOmAhNcsg5fdliQgDW3cVaW6Pwvr%2bh9j18We455WfIvXCuzTy7yWj/xwRcey7ZAHniYiLZE1n4ZIP%2bOi0hb9f242/XTuAv16ZxV8u1/DJybW4eoSUPnQnfn5sPX72%2bFq8d3QT/KiMF2pl/Onss/gNKf27Z4/jV9/ei989fQxvDHh4Wd2Oi6S8sAB70QJaTpA9Yk8fkSAp6CMi%2biQdPZKKHXSvu6cf23sZaWzvS6OnNwON8oW1D/lY/0gJqd0m1uxzcPuDeXTQnO940EXHrIO1szncdsDF9ilyPpUx3PXEgjDxO2jOdzzzxiJo3nc8%2bSo6Dp/BbccXcN%2bhU/DJOX7/0A58fKIT147dg2s00h/OfwMfndiIn85vxFsH78XluY34tyc34M25bvIxNTzu5/C62YtXKeS9XjBw0cngApn%2beRrxlxwZZxlUPkvOvkAW0N8koJkH9NEUyJFzUC1bQCGH16/oCSFNZFQhc2SidlSBTl4%2bG5bJ48eLCGPy6g1JkcCm0MNhy4mHYFfqCcoNNMuVkRZy0SCFN47pZcTlCFE5RlyJhYzoOq5EKFcSySjSezkizA8qCAkBxf8SIaA8JRD3yksQhFXYlENkmnlAMyGQKNxNkucPylWElUFKKKrk%2bS2hsCBCSUjop2mQpVDikmIhxVluuBglHeB7HoUxvi6EAyjFgyJRsShEcShVvwQ4zIqQS8iQv/kiyDRNm%2b9zeTkyAk5LqllXJHLpdHqpBaRJSf5QM3GRKFlgAjJtyQxfcy6QpbjKSnG25RKrPkWLfCkWyFHc53uchfFzj4gxc34rh5C/AMoS2NeB0yavDzlL0nKSQaBIxgRIy6cAO7mRqQcQ0HzijsvGyh/n1JYJyFIyxAqL/MCwW2hPmJr3RDrMKe7/AjhqmRlK7jQnSbNtt0FAuhEGG06Q1wI6ZUjtHV8JrIzl0hSgka1QeBSN0Ee/COK9Zsf42s4vuaffILgOZ3TcZ81xk286DdhJG4aeQ%2b8o5SkvTqB7/4AggZ9b%2bRUsgHP1wdFJsZhgK%2bAGVhpRQQD5gDzN9bg28vnR5bDpEBoKtku%2bL5Q1kxAr6tpL62kr1bM/P7I8mjopY9AIG6ojvsnSVChbteh5jp4pDroeHUTqP%2bfQ%2bcIkTClL9z1KmxMCFEVZdIJsAQo7jjZlm%2bbdmksNAtgJOjTHY1qAiA7wKDdGwzTzsDO0XtDzomzRAsuwiHWN6smOeFct%2bFB9n9YcLkwj35L8nOuIenpyn%2bsxuB5fC9koW7RKlSjd7dlVgRIVKT0fwub5EfF9/pbdb6P7m0TAJ49i43cmkJXstinQsgBJeESNnMTU7H4UyQKK5L0DSn2jwfpSB9ZGAH8kqA5DiguCbWadR2DndIw7L83i/m/TajEsYOcU%2bZOiTyNRw33HR9BXD3D7u/vQ8dZuyJ4LaaAExaM1w2wFnWemRH2u1zsSQPY9bN9dwfY9tJDKu1BcV0iVRp6fGdTmXa89gNQfD6Lr4UGsubofqX9/BL3jlJafGMW2h6roeoQI%2bI9D6Dw9ISwsExSEBTRXwUssQCNWWcF2LJ8CbCU2ZWqscI5ygK2HiYQyhZVqCVLgIz1VwZYfPIi%2bh4fRdaCK9a8/gJ6JpEN3XdxFBIS0LpjEvTQiPHqbSG7fOyDm6DoijonYerCGb7w0iT5a3HSenhTvM1Hb5obRQ8/7awG2PF6HNF7GjoN1bDg/g/6xCMoTu6A8uxsSLYTWX5zBpidH0D8e474Lu9HzYA07qJ3emQrsrA%2bpMfWXECAbKzvA9inQJKA1RdTGup9CEkOhay1tQlVozU8rSVUyxTuK3ChrVCZpkolzvqDR4irD%2bwT0vkr1uI7SeJ/fVTOWgGij1ackLHsUfl03pOW8AYXe1WRCplGP2uBvKKKcfFPm/hhOawq0NkQWfYCzYvhb7gw5E%2bQ9ATNHa3HKB4RswKBrw00kPzPI3BK5vNyo2wbDLS6W26SxrI2V2lv%2bXW6rVW70x6D32YHzrlDLBzSZkK9DwHIiOLUtlCkLjGtfOxTKw3A4FV6yGmTcIAH8MY/y9q8bfBo4JuCGpsD/VQKWJEKrJeDrZP5NAng1KC1fDN1SBHhf4RT4fwK%2bpgQsiQK3tAUsXQzdKgSskAjdalGgdTJ0q4bBlg8QZ4OEW88HpD%2b/I3RLTgHeFrrVUmG2gM9ti2fUGyCADy6%2botVgQazQhkTHGIV/gq9sNVjh1WCYWP1qnaDYEyzG4hzfKcQ3gQhZkrzN7vA6nbfbm/CWlm%2b%2brUZ/i2WxzXfDy%2bHle/03Cz6kSBsOSrqBKF%2bAVKjC8CJxPMertXzjjxXNMv9tRl52BrFaSKqxOAXazwW%2brAXcDJJTp8UtLpNg5YpQgyFkQ/IrcVX8jcXjUydBQigsQ7bykIgwyUwgr6r9pP%2bsa9PyVzUFVguuz9tYPKq8PcVKGboJkxyxbzuYHK6jXhkQ/0UIh8fhhFUo/B71zTEsOKaFHMElaPyHrhs4Hmvvf6b9P0I3kgneLPjbfOw2MDwmHJKcDzFT8rG/4GC66GGv72A8mxxf1weq8ChlzZNvmLFU7DclDJkqJkwFk6aMrMkWtEoC%2bF9iq9kPuBnFW423HbbyX9/ioTGUqnWSo%2bKcQfZiWPTehJZGXZcxTJgyJASGjrQ4MXbEVJAbyifyRi3AWLoj9GX3BL8KIpb4A7rm6ZD8xy85Tg/F4WwEO6ohW51EtjyCbFyH7setv%2bo1T4jlm7CAVTnB/wlClh6ueosHqVQWW9u5ZDubj7QW%2b5ZEkVX7gMYfJVn3fwAA686hh3pclwAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"2560\" alt=\"pihole\" data-srcset=\"/assets/static/pihole.82a2fbd.3d0118d98ece54f58adb02759e32f03f.png 480w, /assets/static/pihole.cbab2cf.3d0118d98ece54f58adb02759e32f03f.png 1024w, /assets/static/pihole.2665e34.3d0118d98ece54f58adb02759e32f03f.png 1920w, /assets/static/pihole.42db587.3d0118d98ece54f58adb02759e32f03f.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/pihole.42db587.3d0118d98ece54f58adb02759e32f03f.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/pihole.42db587.3d0118d98ece54f58adb02759e32f03f.png\" width=\"2560\" alt=\"pihole\"></noscript></p>\n<hr>\n<h4 id=\"install-from-cli\"><a href=\"#install-from-cli\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Install from CLI</h4>\n<p>On our workstation let's add the helm repo...</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">helm repo add mojo2600 https://mojo2600.github.io/pihole-kubernetes/</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">helm repo update</span></span></code></pre>\n<p>Now let's grab the values file that has all of our options.</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">helm show values mojo2600/pihole </span><span style=\"color: #D32F2F\">&gt;&gt;</span><span style=\"color: #24292EFF\"> pihole.values.yml</span></span></code></pre>\n<p>This is a rather large file so I'm going to share with you the parts that I changed. I recommend you look through and find out what options you want for your configuration. First, we need to create persistent volumes and persistent volume claims. We can do this in the Longhorn dashboard or from our workstation. I'm going to do it from my workstation because, well, I have to do everything else from here. Let's create a file called pihole.longhornpvc.yml</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">---</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">apiVersion</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">v1</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">kind</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">PersistentVolumeClaim</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">metadata</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">namespace</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;pihole&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;pihole&quot;</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">spec</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">storageClassName</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;manual&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">accessModes</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #22863A\">ReadWriteOnce</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">resources</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">requests</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">storage</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;500Mi&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">---</span></span></code></pre>\n<p>We can then apply this PVC using kubectl</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">kubectl apply -f pihole.longhornpvc.yml</span></span></code></pre>\n<p>We can now look at our pvc via kubectl and in Longhorn</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1612 202' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-f1201d3c666bc5fc0306045e158186c5'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-f1201d3c666bc5fc0306045e158186c5)' width='1612' height='202' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAICAYAAABJYvnfAAAACXBIWXMAAAsTAAALEwEAmpwYAAADV0lEQVR42m1V227iSBDlT1Za7S6bTcDGgLHBNmBzMyFgTLglQKTMLDOzykNW8/8641NSoRbiodRdt%2b6uU6fs0vJrH43pb3DTP%2bHP/0C4/x3trNhP79Ca/gUvLcPrtGE1I9S6OZxejnqYwulmsKMMtSCF7SWwwrn4Gv0VrM4jptkO6WSMp6cnLJdL7Pd7zGYzPD4%2botfrIY5jHI9HJEmCbreL1WqF0WiERqOBwWAgfsYyl77FYiH59DuOg3q9LsJ9rVaDbdsi5l7j1HbtsywLpf2XHJ2Bg1EWIZw4cAd38Eb3aEYVBCMH8cxHnMQIugnCeIJmMITj99EKE0SDGbxoUNhTxNM13JC%2bGDU3RNAbIiiAY7HD4VCKY1FRFKHVaknhLMj3fbHRTyD4YNqCIJA85jCWMTxLi9a12WxKfBiGksN9p9MRnWCxaN5Hm97FPW2ML/3/%2bRP77Qu%2bn//DKJmgem%2bjbjdxf1fBMBkjm%2bdYr9d4XuXYbTfo%2bB7%2b%2bbuMKAzwdjpgXdhPxwO%2b/fsFvufCtiqoOzXUbOuCOJGmmOhzrVarEkNRv3bUtJm52nkKdRa03W7x9vaG0%2bkkb1XWuK4rd5CFh8NB7GQd2UjAX19fUTp/OyPPl5jP50UHIljFw/2iSAZn2QKbTVH887Po48kEo/EYiyyTC4hy1bIE2XlB0aywu24LNYN6JlXNzpl7syj13Yo3wTF9JsjqvzUC5phcRuB4PMmsEaV%2bvy8BpMe4KDRNU7HTz%2bJoo0ynUxFSiQiTSgSI6HPPM0i/drt9KczzPOkI91zpV7kGi37GU6jzPaQ67QSbuhbPfI2lzwRTYxhPv%2baZvtL3Hz%2bkmJeXF2EBO8vgcrkshbP79JNmpFulUsHDw4PM5W63Ex%2bZoB84AsFzKHmeC6gEj3QjmMwjBanTTl3v1ibwDTyXHz7G8W7ulb7v7%2b%2bSp%2bAz/3w%2b4%2bPjQ6jNzmqROgKfn59yjvkRFQBoJLrslqJE4cdnUlBeu8%2bVh9PHbjGeDGBX%2bAheorlml7T7tHHVjpk6z6KuzDD3%2bibtPt9KG9drBmjs9V9C6zOZcwGAhVWKjprzRSc7wE6wy/ob4kiwWJ0h/VDRttlsLvQ359Q818y7pZvxt2b%2bejV/g6bc%2bs5c36H2Xx4GbGgGyWevAAAAAElFTkSuQmCC' /%3e%3c/svg%3e\" width=\"1612\" alt=\"kubectl pvc pihole\" data-srcset=\"/assets/static/kubectl-pvc-pihole.82a2fbd.39a29349af1fae30987ad7a720087400.png 480w, /assets/static/kubectl-pvc-pihole.cbab2cf.39a29349af1fae30987ad7a720087400.png 1024w, /assets/static/kubectl-pvc-pihole.cf0e403.39a29349af1fae30987ad7a720087400.png 1612w\" data-sizes=\"(max-width: 1612px) 100vw, 1612px\" data-src=\"/assets/static/kubectl-pvc-pihole.cf0e403.39a29349af1fae30987ad7a720087400.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/kubectl-pvc-pihole.cf0e403.39a29349af1fae30987ad7a720087400.png\" width=\"1612\" alt=\"kubectl pvc pihole\"></noscript></p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 572' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-e43e950f1f959b31c87b6dbfa1cf48c0'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-e43e950f1f959b31c87b6dbfa1cf48c0)' width='2560' height='572' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAOCAYAAACfOxrCAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFoUlEQVR42r1W%2bW9UVRh9QlsWhQKSEJFFEkyMf4uRRcoiCEGQBARUEgQUCGsUKFBbEPEHIbK2tCCUtpS2EMAQgem0EIFKoYUus0BpZ3lv5s28N%2b947n0z0%2blCU5roTU6/7zv32%2b6d%2b%2b6tcv5%2bC6YdvYEfqu4jFAqh1eOFy/Mc3hdtlF48bXEBUR3Z1%2bqgrDmBMZvPYvTmIgz/7gzS1%2bcjc2MhMsmlrTyCEQv2I3NRLkZSpi05hDc3FmEk50cIn02FGLqhAEPWF2DUpiKJDOqCy4zbw5hz8LenMXhdPuUAEI8btPZ0vyBqKWJhH/12HZ/n30JbewcanjWhsakZTa0uyhY8anwGM6xix5WHUJYf5aILkLHhDDfjJJTVx/GGKLie9uLDUGZnY9DcfVCy9kCZmwNlbT5xWiJtXQGUr09IDKaexjzKV7S/OYlBzCHyKmtOQfnydygrjw0QjF11TOaU/aXKhL4mhRO%2b7nY/nE89aHzeAZUnQAuHJdRQHNSjER1X6prwfbED28qc2FJaLeX2S7a%2bhfrOUge2n7uJbYSQOy/exlbyWzlvS2fXGELoiXyJnDsu1QwYO8trZJ5lx69jybFrWHqcoPyC9vJTN6SeBOc2XXRAaXG58aThCf6pr8fjp8/gaWuHm8ff3fbSxouXcBEdPh%2bioSAiGhGXutZp6yEVEV1LQuepkX7dob1Cj0PXBoawGgCMMB40tmDSsoP4cPWvmLriF3yw6jAm0xbyfdpTVxyScvzSPFQ6H0Fp9wfgVzUEtJD8xbWwDk2PELrUQ3E9yLlAN/i1hAzBxxw9EfoPoMXr6vG6nRC9uNsDuHCnHsWOTlwgSp2PUV7bgFv1rbhNVN5rRF2LF4pYtGmaUFUVGhOGuWihiwsxzOMfTPLcHE2Tc7avluQMw4AYFrqO3uz%2bcKl8b3ORaFTWNWMxWHSw%2bCdGPWb15t05HrnasehAKeblFOPq301AzIAS5EIt04CfRzysBmHye1cDfoS4yKjOBVLXNRUGdTUQkHNaMJDkhB9iJv7PYRkRqH5fZ12r61ZZYmPikHNCctQ2eLAwrwSf5V7kyXgMIxqBwr84cq8Zc/5wYvY5J6YV3sG88zWYT8wqcmDG2WrMEJKYf6EWn5L/hNx02jMlV4Ossw4ZN/tctYybx1xz4lxWnJtLOZO2zM95wWUxfjrtGYUO5nUmY2cV3ZH89Li/mFvAOkKKWqKXmexVSMEvLBY9OfDxmc4eErmyUnItLrmLFRUPsLLyAUKGydOtcQMsA%2buuPsTUn6swcu8lpP1YgnE/XcbEvAq8tbsEGbtKJYbuLsXkg1WYkHtZ8um7SjCM3IS8SozOLkU648bmXLZ9yI3dVya5t/eX4z1y43LKMZz%2b6cw1PrcSkw5UYlS2nVvkmUh7Cnt4N7dC8kN22chgHZFPzlGO2VsmeZFb9CTyiPwjssvivVfIHqYctP1Hx2sM31NG3yrWrsA7XJ8rEJKfuRLid9waDOOv1nbc9folajyEN4BaIsE53X7cbO7An8Rtl09ytd38ajw%2bOAkR7/TYcbWClzIgdZnLY3M13k6farfP5jw2EnXt2j45L2TqnIhzuAUCspdED9W9%2bIt5wTmIu/SJ8gT4%2bfkq4vbvMXg5iP/%2beDl0ob383FsCFqIpdExnvBlNDe5qM4cVCdt%2bKT6C63HF8f6RtV9nxPifasjR39sjWVPcD74gNyDIDRCUQcKMWfIm1SN8%2bng8dN62wo6YFjyqiWa/ibo2A086DAQiMXn7anxFhL/wE4jyRUi19UgUqnhieWtH%2bdqwhPSRtmFKH1OA9UXNsG7Hil76Bvu1xF77%2bfy32nof/rI31hc1pZ26AfZFaiXRZc/inCGD7GRR05apvt1j%2b8rVG9dbbL%2bQ%2bF376Z/M39cG9AyyennZrddr9D8BXqH3D2ID/gXH2O7UAGDTgAAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"2560\" alt=\"longhorn pvc pihole\" data-srcset=\"/assets/static/longhorn-pvc-pihole.82a2fbd.7ec8bab0115c15eb165ad023327d3094.png 480w, /assets/static/longhorn-pvc-pihole.cbab2cf.7ec8bab0115c15eb165ad023327d3094.png 1024w, /assets/static/longhorn-pvc-pihole.2665e34.7ec8bab0115c15eb165ad023327d3094.png 1920w, /assets/static/longhorn-pvc-pihole.42db587.7ec8bab0115c15eb165ad023327d3094.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/longhorn-pvc-pihole.42db587.7ec8bab0115c15eb165ad023327d3094.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/longhorn-pvc-pihole.42db587.7ec8bab0115c15eb165ad023327d3094.png\" width=\"2560\" alt=\"longhorn pvc pihole\"></noscript></p>\n<p>If we click on the volume in Longhorn we can see it's replication status and details.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 725' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-5f4d86b3ece7dfa667fc530832f9d0cc'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-5f4d86b3ece7dfa667fc530832f9d0cc)' width='2560' height='725' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAASCAYAAADrL9giAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEuklEQVR42tVYW4/aRhTm//%2bL9qWt0qoPrdSHKmrVKG2yabguZFlYYJfbYsB3G9vAnn7f4KFer03IqpWSkY7mwvGZM9%2b5zVAZTabSH93KcDyRu9kc/Vh6w6F0b27Qj9RY0WCo%2bPpYG4H3qn%2bjqNO9lunCkKVli2FaXwQtSGtTDOhcuV%2btZWYYMl%2bu5DBeqgNN7hdqrPsZ1rjOMXk1z3h%2br4SubOeLIcv1xPZ8pXdliQVFQENROl/l%2bkdkPRZoZKyv5Rjm5%2bsRXhBIFMfS/nAlFReTMIqwkKg%2b3ICi%2bDD%2bRNpAKOXZnicbyFAUP0/W/008b6vdkUqUJDKbzWQ6mcj47k4GiP04juS5bbvbSYAN1quV9Ho9Wa/X8rm2zhU8gEg8PDzIDorv93tFnD%2bH2BbLpbh%2boMZ67b9unyq3TFcVAnGyFRJdP4LlfN%2bHB8SPPiwTkhfIvgurMwTY5vO58qq7EzQajcR1XWUAzk/x397eyhhVikaybfsw/wg/dcgDp/uOBiBCrNquL2EYiuM4qi9Dr8gCxzn6HkLIQYZlazab8ufbC6nW6tJoNOTy8lLa7baiVqslnU5H6vW6LOE12%2b1W3l5cyJt37xV/s9k48pL0t/yOYPFgr17/JX9X61Kr1dR6lpeyuXZ9fX0uAB4OvhEHve%2bH4icbsRP/LPfLA6A9oArFvvr2hfz88g95X2uoQxEITQSoWq0qAGjVl7/9Ll9/94P8%2buqN1BuPeTXxUMwzi8VCvvn%2bR3nx0y/y%2bh0AKJBNcPMAZA35LwDIA5aDgwcbcWE9x3HFDly5D03xfACDmDZ8S8zYPekBOgS0B9ANO50P0oY1bgBMv99/Qt1uV7kzPYA8l7DgFZJTET%2bTKtfpAaa5Vt%2b2YO0iuSQenjqUAZDmgETlAALgeoF4ngvhpjhQKtklKhxClDY/CiXCvAwAvWYDPJbCPF92cx7gY56leXVifvqblPKfMlCpB5i2iwvCRkxcciwcgj0T47kZWK9TnheET4BhbmHCI02n0%2bOhSqsJXHyIKziJBilNxFgnoEx4lE2Le2kIFuWu7HzNq3AM1%2bOFhdY3LdyS4O7b3f5QFdISeU4S1Gu8%2bOQB0L8l8DZWmVPlKSub3sfKdC4/D14GbJE%2b1PPoAYxbui8VzLpo/uNTdZYtygCgleHBJ7hoaQsNBgNZ4aJUdhiWRVpUW5U917TMvC7aW1gitYfpUp4NiSf7wNhHAFgGGQJ%2bECgkA/QJvOOcO0AZAFyj4hpUKsOegBTeIrEfQ4V769gnb1HOYCMf5fOwOreQv7RM5%2bYpAIlSmiFAEFgJmJVZmih8m4Jw7u0sGwK0CGsyszU9IEv8jZalN%2biLEDM3%2bZnpi/hpZXoQeakjaz2JcvL82tN4X8gbak9daRwCQCvHaQi4qP8B7gKui0SIfECiNxDhaLORBH3MhwTHBA5j9lmQ%2bLbw04sUlVQEOXwT5InJjW8GyqG1dfWxLLOUn8RDMD9YKb9ZxJv29KiyxmpVobJEYqWyvycm7wCwyJoA4KnLfoWNDChq8qkLoWqMjY3l6sCHTWh5lUzVa9BX84QumRITayHh4ASN/Jwf%2bPel/PyN%2bzB0Nf/2JP8ufd1m6fBy5f8C/wBWg0iNTehRfwAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"2560\" alt=\"longhorn pihole pvc details\" data-srcset=\"/assets/static/longhorn-pvc-pihole-details.82a2fbd.50ea86500824c9c46012842a8dd7ebcf.png 480w, /assets/static/longhorn-pvc-pihole-details.cbab2cf.50ea86500824c9c46012842a8dd7ebcf.png 1024w, /assets/static/longhorn-pvc-pihole-details.2665e34.50ea86500824c9c46012842a8dd7ebcf.png 1920w, /assets/static/longhorn-pvc-pihole-details.42db587.50ea86500824c9c46012842a8dd7ebcf.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/longhorn-pvc-pihole-details.42db587.50ea86500824c9c46012842a8dd7ebcf.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/longhorn-pvc-pihole-details.42db587.50ea86500824c9c46012842a8dd7ebcf.png\" width=\"2560\" alt=\"longhorn pihole pvc details\"></noscript></p>\n<p>Perfect! They are both there! We can now work on our pihole values. I'm going to break this up and show the parts I have changed. You will want to verify all the information for yours.</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #D32F2F\">dualStack</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- set this to true to enable creation of DualStack services or creation of separate IPv6 services if `serviceDns.type` is set to `&quot;LoadBalancer&quot;`</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">enabled</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">false</span></span>\n\n<span class=\"line\"><span style=\"color: #D32F2F\">dnsHostPort</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- set this to true to enable dnsHostPort</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">enabled</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">false</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- default port for this pod</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">53</span></span>\n\n<span class=\"line\"><span style=\"color: #C2C3C5\"># -- Configuration for the DNS service on port 53</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">serviceDns</span><span style=\"color: #D32F2F\">:</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- deploys a mixed (TCP + UDP) Service instead of separate ones</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">mixedService</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">false</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- `spec.type` for the DNS Service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">type</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">LoadBalancer</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- The port of the DNS service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">53</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- `spec.externalTrafficPolicy` for the DHCP Service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">externalTrafficPolicy</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">Local</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- A fixed `spec.loadBalancerIP` for the DNS Service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">loadBalancerIP</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;192.168.1.201&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- A fixed `spec.loadBalancerIP` for the IPv6 DNS Service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">loadBalancerIPv6</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;&quot;</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- Annotations for the DNS service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">annotations</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">metallb.universe.tf/address-pool</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">default</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">metallb.universe.tf/allow-shared-ip</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">pihole-svc</span></span></code></pre>\n<p>To go over my changes, I set dnsHostPort to true, disabled mixed service, set LoadBalancer to the type, set the IP from the range we configured before (I want to ensure this stays the same no matter what), and annotated the svc and the address pool for metallb. Let's keep going. I don't want DHCP so I'm skipping over that part. For the web service...</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #C2C3C5\"># -- Configuration for the web interface service</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">serviceWeb</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- Configuration for the HTTP web interface listener</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">http</span><span style=\"color: #D32F2F\">:</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #C2C3C5\"># -- Generate a service for HTTP traffic</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">enabled</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">true</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #C2C3C5\"># -- The port of the web HTTP service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">80</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- Configuration for the HTTPS web interface listener</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">https</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #C2C3C5\"># -- Generate a service for HTTPS traffic</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">enabled</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">true</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #C2C3C5\"># -- The port of the web HTTPS service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">443</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- `spec.type` for the web interface Service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">type</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">ClusterIP</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- `spec.externalTrafficPolicy` for the web interface Service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">externalTrafficPolicy</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">Local</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- A fixed `spec.loadBalancerIP` for the web interface Service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">loadBalancerIP</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- A fixed `spec.loadBalancerIP` for the IPv6 web interface Service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">loadBalancerIPv6</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;&quot;</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- Annotations for the DHCP service</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">annotations</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> {}</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #C2C3C5\"># metallb.universe.tf/address-pool: default</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #C2C3C5\"># metallb.universe.tf/allow-shared-ip: pihole-svc</span></span></code></pre>\n<p>This is pretty self explanatory. I set ingress to false and kept moving until I found the persistent volume claim information...</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #C2C3C5\"># -- `spec.PersitentVolumeClaim` configuration</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">persistentVolumeClaim</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- set to true to use pvc</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">enabled</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">true</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- specify an existing `PersistentVolumeClaim` to use</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">existingClaim</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;pihole&quot;</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- Annotations for the `PersitentVolumeClaim`</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">annotations</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> {}</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">accessModes</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #22863A\">ReadWriteOnce</span></span>\n\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">size</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;500Mi&quot;</span></span></code></pre>\n<p>We need to match this up with our volume we created earlier. Now I leave everything the same until we get to the password section and extra vars...</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #C2C3C5\"># -- Use an existing secret for the admin password.</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">admin</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- Specify an existing secret to use as admin password</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">existingSecret</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;pihole-secret&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- Specify the key inside the secret to use</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">passwordKey</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;password&quot;</span></span>\n\n<span class=\"line\"><span style=\"color: #C2C3C5\"># -- extraEnvironmentVars is a list of extra enviroment variables to set for pihole to use</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">extraEnvVars</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">TZ</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;America/Cancun&quot;</span></span></code></pre>\n<p>You can put your password directly into the yaml but I like to use secrets and not have passwords stored in clear text. You can configure yours how you choose but here is how I created my secret:</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">kubectl create secret generic pihole-secret \\</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    --from-literal=</span><span style=\"color: #22863A\">&#39;password=&lt;ADMIN_PASSWORD&gt;&#39;</span><span style=\"color: #24292EFF\"> \\</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    --namespace pihole</span></span></code></pre>\n<p>As we continue through the values, I set DNS based on my local one as well as cloudflare at 1.1.1.1. Next I enabled cloudflared</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #D32F2F\">doh</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- set to true to enabled DNS over HTTPs via cloudflared</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">enabled</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">true</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;cloudflared&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">repository</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;crazymax/cloudflared&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">tag</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">latest</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">pullPolicy</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">IfNotPresent</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- Here you can pass environment variables to the DoH container, for example:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">envVars</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">TUNNEL_DNS_UPSTREAM</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;https://1.1.1.2/dns-query,https://1.0.0.2/dns-query&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">TZ</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;America/Cancun&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #C2C3C5\"># -- Probes configuration</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">probes</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #C2C3C5\"># -- Configure the healthcheck for the doh container</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">liveness</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #C2C3C5\"># -- set to true to enable liveness probe</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">enabled</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">true</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #C2C3C5\"># -- defines the initial delay for the liveness probe</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">initialDelaySeconds</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">60</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #C2C3C5\"># -- defines the failure threshold for the liveness probe</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">failureThreshold</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">10</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #C2C3C5\"># -- defines the timeout in secondes for the liveness probe</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">timeoutSeconds</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">5</span></span></code></pre>\n<p>From here we have dnsmasq section where I recommend adding in all of our nodes. You can also do this later via the web interface. It's up to you. Both ways work great! Finally the last section</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #D32F2F\">podDnsConfig</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">enabled</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">true</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">policy</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;None&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">nameservers</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  - </span><span style=\"color: #1976D2\">127.0.0.1</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  - </span><span style=\"color: #1976D2\">192.168.1.1</span></span></code></pre>\n<p>Once we have all of these configured, save the file and let's double check out secret in Rancher or via kubectl. Then deploy our PiHole instance!</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">kubectl get secrets -n pihole</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">kubectl get pvc -n pihole</span></span></code></pre>\n<p>Alright, we look good, let's deploy!</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">helm install pihole mojo2600/pihole \\</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  --namespace pihole \\</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  --values pihole.values.yml</span></span></code></pre>\n<p>We can watch this deployment with</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">watch kubectl get all -n pihole -o wide</span></span></code></pre>\n<p>Once everything is done we can verify our ingress</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">kubectl get ingress -n pihole</span></span></code></pre>\n<p>Now we just add our DNS info like we did for Rancher. We are good to go!</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 1775' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-d33d4a3d0e85f738ce053d8c87e35c98'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-d33d4a3d0e85f738ce053d8c87e35c98)' width='2560' height='1775' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAsCAYAAADVX77/AAAACXBIWXMAAAsTAAALEwEAmpwYAAANYElEQVR42u1a%2b3McxbVeFyAbA5GxsY0s23rs7LxnZ3ZnZnfnsavVSqu3ZOQXOEBiC9tYBhcGYjAY2xDZQBJDQmKKR9nBJNyQqlTdqpCQVFLcR6VS%2bSGVH/IffTmnZ3e1EorBMje3uL4/fHt6Hj3d5%2bvT55zu3pTrusjn8/B9H0EQoFgswHXz4l7zGUvLsmAYBkyTYSZoXf8rYV4X3EfP81AplzEzM4Pp6WnMMGamqTyFvXv3Yv%2b%2bfdizZw9mZ2eRYgUTAgoIwhDFUkAKe8jlcsg7DsEWH7SyNgxuhIjQqRFN00XZMP81MBtStK3r0HVDgMsCWgJV1ZC1bRSKRYyOjmF8fBwj4xMYJYyMjmJicgrTRAyTMzU1hVQmk4EkSchoJmTThmxkoZgO9GIVejAEPR6FYntQ6Z6WzYtnWbcILyiLspbNQb0erBw0i8v5Lw1%2bn7%2b7HDrB8UtwSxFyfoBcIYQfVui6jEI0QKiiVB4U124pFs8zOvXX05HNG4QSbK%2bEjGoInRmCAAHFhKbmoBgOkWBDyYfQoxEYgzNQnQJkPSFG0iw49JGoUoNEdRTdFpAbMilnIWtZITMNyLoFheoq%2biJkrR1mIhvvS/SdNHWepUQy3ZBZL0S%2bVElkUEVQHUGpMoSoNopoaBzl%2bgRKdC%2bsjaFI93eaOQyRfrWMTIMaC3K4LTHodD8lyzLktIyMq2NH1YLEpk6jYNo02jp1StWJFFsoLzek5ZagugWohSI0Aku9UFosFwNYQQSzFMIu0mgVIhjUabU0AI2gNmCQAlY4CJMR1QRs6qBD77vFEk1Hj0w5QbEh/QLJkk/PCgI5mrqmF9DoUpn67BByjkdTl/wXSZ/66fshCmwtZLkuvWvQfVaedU/JCinfK6En0lF4vgvqoIx8cRBju2aJ5RL6VSKlOYo0RTSyECOOcf9cDduODGPb4SF0H6lj86EB3P9YDV10f8NDAdbuzuOOAx52TIbwKqPYevI1dJ97B10v/gTdL13GtjOX0fncj9Dx9CWse%2bp7WDf/Xdzx7A%2bxZe55%2bETOD44q%2bNVpCb84JeOXz6v4%2bDlZ4KNnenDl2Ca8ffg%2bfPjERrz52E545RqOxwEuDwd4YzjCpWoRbw6H%2bGE9wuuDJZxzNZzNKThPOOebKNI0SjctQKGfXiIh2pnGpx134uSmLXBiHSOTwxiieTVUrWGgPo5oYEj4AJXMUCmHWH8kwsb5Qaw/HOKeo2WSETbR9eYjdO9ggNS0htR%2bE5tnaGQq4%2bh88W10XvwZ7l24hq2v/RxbCOvOX0HqzPtInbyE1NGXkXr6Tdxz7Dy8YgUfnOjGf73cjd%2bf6cIfz%2b3AH85247NX%2bvGLp7bigyPrcOXwelw7shbXjm9EoTyA75Ty%2bCDO4v2qi/fKObxfIZQdXIocLGT7sWD24BWjh8pphF4BfURAYgFEQJpgZRRc3bABx7t2kDMxsGtmFAPDExgem8QgETAwNAqNzEs3cpCjAD1PTWDL/BCmL51E/bV5KKcopOwhpWcIeyys2WUitdfE/VMFZMuj6Dn/Doav/hZdFz5A6pm3kDp1Gann38aaUz9G6vgFrDl6Dqn5BXTOnSbzL%2bPq0yo%2bW5Dx32/V8ed3ZvD78xJ%2bOX87fvzonaT83fjo%2bN348PH1ePfoZvhxBaeqMT498Riu7RnD1ckqPv7WPvz6qaN41dexQIp/z5FwwerDy3aGCCgKnYUFCAdIbOyUNQohBpm8if4shRkKgxo5EJ2U5gigUHRI0/NMxkAfzcH8uYcx86Nn8PC7L2HuyisIF%2baQOmAhNcsg5fdliQgDW3cVaW6Pwvr%2bh9j18We455WfIvXCuzTy7yWj/xwRcey7ZAHniYiLZE1n4ZIP%2bOi0hb9f242/XTuAv16ZxV8u1/DJybW4eoSUPnQnfn5sPX72%2bFq8d3QT/KiMF2pl/Onss/gNKf27Z4/jV9/ei989fQxvDHh4Wd2Oi6S8sAB70QJaTpA9Yk8fkSAp6CMi%2biQdPZKKHXSvu6cf23sZaWzvS6OnNwON8oW1D/lY/0gJqd0m1uxzcPuDeXTQnO940EXHrIO1szncdsDF9ilyPpUx3PXEgjDxO2jOdzzzxiJo3nc8%2bSo6Dp/BbccXcN%2bhU/DJOX7/0A58fKIT147dg2s00h/OfwMfndiIn85vxFsH78XluY34tyc34M25bvIxNTzu5/C62YtXKeS9XjBw0cngApn%2beRrxlxwZZxlUPkvOvkAW0N8koJkH9NEUyJFzUC1bQCGH16/oCSFNZFQhc2SidlSBTl4%2bG5bJ48eLCGPy6g1JkcCm0MNhy4mHYFfqCcoNNMuVkRZy0SCFN47pZcTlCFE5RlyJhYzoOq5EKFcSySjSezkizA8qCAkBxf8SIaA8JRD3yksQhFXYlENkmnlAMyGQKNxNkucPylWElUFKKKrk%2bS2hsCBCSUjop2mQpVDikmIhxVluuBglHeB7HoUxvi6EAyjFgyJRsShEcShVvwQ4zIqQS8iQv/kiyDRNm%2b9zeTkyAk5LqllXJHLpdHqpBaRJSf5QM3GRKFlgAjJtyQxfcy6QpbjKSnG25RKrPkWLfCkWyFHc53uchfFzj4gxc34rh5C/AMoS2NeB0yavDzlL0nKSQaBIxgRIy6cAO7mRqQcQ0HzijsvGyh/n1JYJyFIyxAqL/MCwW2hPmJr3RDrMKe7/AjhqmRlK7jQnSbNtt0FAuhEGG06Q1wI6ZUjtHV8JrIzl0hSgka1QeBSN0Ee/COK9Zsf42s4vuaffILgOZ3TcZ81xk286DdhJG4aeQ%2b8o5SkvTqB7/4AggZ9b%2bRUsgHP1wdFJsZhgK%2bAGVhpRQQD5gDzN9bg28vnR5bDpEBoKtku%2bL5Q1kxAr6tpL62kr1bM/P7I8mjopY9AIG6ojvsnSVChbteh5jp4pDroeHUTqP%2bfQ%2bcIkTClL9z1KmxMCFEVZdIJsAQo7jjZlm%2bbdmksNAtgJOjTHY1qAiA7wKDdGwzTzsDO0XtDzomzRAsuwiHWN6smOeFct%2bFB9n9YcLkwj35L8nOuIenpyn%2bsxuB5fC9koW7RKlSjd7dlVgRIVKT0fwub5EfF9/pbdb6P7m0TAJ49i43cmkJXstinQsgBJeESNnMTU7H4UyQKK5L0DSn2jwfpSB9ZGAH8kqA5DiguCbWadR2DndIw7L83i/m/TajEsYOcU%2bZOiTyNRw33HR9BXD3D7u/vQ8dZuyJ4LaaAExaM1w2wFnWemRH2u1zsSQPY9bN9dwfY9tJDKu1BcV0iVRp6fGdTmXa89gNQfD6Lr4UGsubofqX9/BL3jlJafGMW2h6roeoQI%2bI9D6Dw9ISwsExSEBTRXwUssQCNWWcF2LJ8CbCU2ZWqscI5ygK2HiYQyhZVqCVLgIz1VwZYfPIi%2bh4fRdaCK9a8/gJ6JpEN3XdxFBIS0LpjEvTQiPHqbSG7fOyDm6DoijonYerCGb7w0iT5a3HSenhTvM1Hb5obRQ8/7awG2PF6HNF7GjoN1bDg/g/6xCMoTu6A8uxsSLYTWX5zBpidH0D8e474Lu9HzYA07qJ3emQrsrA%2bpMfWXECAbKzvA9inQJKA1RdTGup9CEkOhay1tQlVozU8rSVUyxTuK3ChrVCZpkolzvqDR4irD%2bwT0vkr1uI7SeJ/fVTOWgGij1ackLHsUfl03pOW8AYXe1WRCplGP2uBvKKKcfFPm/hhOawq0NkQWfYCzYvhb7gw5E%2bQ9ATNHa3HKB4RswKBrw00kPzPI3BK5vNyo2wbDLS6W26SxrI2V2lv%2bXW6rVW70x6D32YHzrlDLBzSZkK9DwHIiOLUtlCkLjGtfOxTKw3A4FV6yGmTcIAH8MY/y9q8bfBo4JuCGpsD/VQKWJEKrJeDrZP5NAng1KC1fDN1SBHhf4RT4fwK%2bpgQsiQK3tAUsXQzdKgSskAjdalGgdTJ0q4bBlg8QZ4OEW88HpD%2b/I3RLTgHeFrrVUmG2gM9ti2fUGyCADy6%2botVgQazQhkTHGIV/gq9sNVjh1WCYWP1qnaDYEyzG4hzfKcQ3gQhZkrzN7vA6nbfbm/CWlm%2b%2brUZ/i2WxzXfDy%2bHle/03Cz6kSBsOSrqBKF%2bAVKjC8CJxPMertXzjjxXNMv9tRl52BrFaSKqxOAXazwW%2brAXcDJJTp8UtLpNg5YpQgyFkQ/IrcVX8jcXjUydBQigsQ7bykIgwyUwgr6r9pP%2bsa9PyVzUFVguuz9tYPKq8PcVKGboJkxyxbzuYHK6jXhkQ/0UIh8fhhFUo/B71zTEsOKaFHMElaPyHrhs4Hmvvf6b9P0I3kgneLPjbfOw2MDwmHJKcDzFT8rG/4GC66GGv72A8mxxf1weq8ChlzZNvmLFU7DclDJkqJkwFk6aMrMkWtEoC%2bF9iq9kPuBnFW423HbbyX9/ioTGUqnWSo%2bKcQfZiWPTehJZGXZcxTJgyJASGjrQ4MXbEVJAbyifyRi3AWLoj9GX3BL8KIpb4A7rm6ZD8xy85Tg/F4WwEO6ohW51EtjyCbFyH7setv%2bo1T4jlm7CAVTnB/wlClh6ueosHqVQWW9u5ZDubj7QW%2b5ZEkVX7gMYfJVn3fwAA686hh3pclwAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"2560\" alt=\"pihole\" data-srcset=\"/assets/static/pihole.82a2fbd.3d0118d98ece54f58adb02759e32f03f.png 480w, /assets/static/pihole.cbab2cf.3d0118d98ece54f58adb02759e32f03f.png 1024w, /assets/static/pihole.2665e34.3d0118d98ece54f58adb02759e32f03f.png 1920w, /assets/static/pihole.42db587.3d0118d98ece54f58adb02759e32f03f.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/pihole.42db587.3d0118d98ece54f58adb02759e32f03f.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/pihole.42db587.3d0118d98ece54f58adb02759e32f03f.png\" width=\"2560\" alt=\"pihole\"></noscript></p>\n<h3 id=\"unifi-network-application\"><a href=\"#unifi-network-application\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Unifi Network Application</h3>\n<p>This, I know, doesn't apply to everyone. Personally, I use Ubiquiti switches, access points, gateways, and cameras. That means having either this software installed on my workstation, a server, or in k3s how I'm going to. Previously, I've ran this in docker but if it goes down I'm unable to configure any of my devices or manage my network. Our HA k3s cluster seems perfect! </p>\n<p>First things first, let's prep our environment. In the Network project I'm going to create a new namespace called unifi.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 786' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-84121778570eb79466f0634e58898836'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-84121778570eb79466f0634e58898836)' width='2560' height='786' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAUCAYAAAA9djs/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAELklEQVR42t1XyY7bRhDVDzgYjTZuzSYpkhIlkaNlRssssT1JDMMTIHAujg/%2bgdz8H7nk5ORvcg6QbyrXa7I51CySYsmA7cNDL6Kqql/X1jXbdsmxZQnb9si0JBmmq0bhdskRwTeLmswuSY6WCu5oRUEypbP5ii4un9NkulBEWEzKt4qaiDISUUqyNyG3NyYvHNJgkFF2MqN%2bkiqPcIRPjrMddgVagX1n/0tDTQZ9EjImW4Rku0BEJs8Np6tGx%2bvtBJtlOD7L8mLyvIjCaKDgylCF0Tbgu03AN5JlYw7X3fb9LvJUCAyGEwr8mI6OWtRoGNQ47uRjgWNe74Y2NVu2IgME9PopIyOXSRWiclixfnBH5HtVr7kLHa9ZdkrT2ZI8thf5aR/Xh32S7axFPZ74PWobLhmWRx2zCvm/YNhsKN8SjK3eLBQ9BFfyKPP5pkSlbwtGp9mMumGyRsynoPQAGG2yu%2bfuXwEbhsOIHeBocBhYiK3PEPtWUZ06Rp6UHSc4TA5wOQcgBPygpwD39XntMkMmSiHDMAUZhijmLhshyj2MFtxRY5%2bsXJWzTabal4//ZyuKKuCFI4p7I4riHGE8VCPcEh9MpnNarq5osbyk%2beKCzi%2beqhH7s9Mll8tnijhFStE/aHzpVUAR0DQ41oOU2m6fWoyOn1LT9Om43lY3jJg7PTun8WROJ%2bNT1Rvg4FhjDqTZVJHYTzIaDMdqxF7Q7T1Kgo7F6u%2bPecahDgx95Vr3AY2mydnboiZGhXyOCoBbRSkbjiblAZGAcOMYg25fIWKvwRrfYq5HZOv8oN17CUiHki5rOilBtpYbdJOKjH2Qy8Y5q7pyAvigzQK69FUJ8LhCICRirhYwyCpbZalGs3T7dffXrfRDtwlDrr6/plevflHfgDBtJOb95ISiKCcSBOzb7emW/s1v74ryF98hoLz9W2AfIYA/Vt1n39vQt496vjp/qubVxkTrqRK2r07IgI7rH14qD6uG30YC4AFIhvgTxl06um3ATcMYeEGdGyjMYaAmwKtUpF27yN30BvTku8a9/LOVALh9MjhROeAQCQmKW22bzvn2f3pxo/aQLzQ5MYdbMhgrfdg7hE7IgKzXv75RIYCwXiPgQfDtGEWSylkMD/L8hCw0M4vlFT17/kKFgPauagf5Sa5fkLi2LuRCx83Pr7nMj1Tz5nrILdwI4TbaD6DVtj7bUxiHg15UIMz37etvmyj3tkECYD/2uFmDjnq9Re2jOrUYGM2OTTVt0D2BG%2bryoUiwD6UD3uInJMKUnO6IbLxOGeqpz3uCn/pYy2RGk9//pNX7DzR//zf5i5e3BNzDV/CWL%2b2Euwf89O7PSMRjRQbgJme8NyU5mKunukxXdPHHP3Tz17/044f/KLx%2bu8EDviaACDzgRPGoQ%2bnDvESQ76vvIjIZFsPmB9VHJPfMvyoe1s8AAAAASUVORK5CYII=' /%3e%3c/svg%3e\" width=\"2560\" alt=\"create unifi namespace\" data-srcset=\"/assets/static/unifi-namespace.82a2fbd.4386cad4cb0ebc90e15afee0a7fdb1fe.png 480w, /assets/static/unifi-namespace.cbab2cf.4386cad4cb0ebc90e15afee0a7fdb1fe.png 1024w, /assets/static/unifi-namespace.2665e34.4386cad4cb0ebc90e15afee0a7fdb1fe.png 1920w, /assets/static/unifi-namespace.42db587.4386cad4cb0ebc90e15afee0a7fdb1fe.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/unifi-namespace.42db587.4386cad4cb0ebc90e15afee0a7fdb1fe.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/unifi-namespace.42db587.4386cad4cb0ebc90e15afee0a7fdb1fe.png\" width=\"2560\" alt=\"create unifi namespace\"></noscript></p>\n<p>Once created we can go ahead and begin creating our app. Click on Workload and select StatefulSets then click the Create button.</p>\n<p><img class=\"g-image g-image--lazy g-image--loading\" src=\"data:image/svg+xml,%3csvg fill='none' viewBox='0 0 2560 660' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-d8ff92bb7539d7f6871577e44040c271'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-d8ff92bb7539d7f6871577e44040c271)' width='2560' height='660' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAARCAYAAABtu6qMAAAACXBIWXMAAAsTAAALEwEAmpwYAAADE0lEQVR42uVXy27TUBD1F0CTOIkdv%2b3Edh5OSlpegiK10CJQWSEkNmwqKtiBYMkf8Bkg8VP9mMOc29zGbZo0VaFq1MWRrx17Zu65M2cmRtodItjcRa/YQLvThd0K4LiRunZ7IxTDMYKwA89PFFwvhh%2b0ESc5Wk54Y8E9JO2uipUxjzceqvt2p4cgSmHWffz48x1Gmg0Q9B4glh9D2Sg3rg1Ecabgeom6pyGSQKMkhfc3FYyTG2acjJeHGScZwiiD1/Jg3qng7cc9GMXgHkI/QmWtjlrNgmnaCrbtKyOhsEUSeOJRnCrjJEOTdJNRzgZL9tNiZlsukidvMHr3FcneJxiJbCxN%2b6jXW4oAgmvL8tAfrGN7Zw9bz3bU9enWtmKwbPyml0F57UgmW2YDo8Of2P91hFe/j2Bk%2bQC5wJfTruoMEAKcJYyvAhjrTIkEKZwwhxvlMPq9IQZy0onUR63aPCkDp6QFZWNn02sRMZc5qX9hc%2badyZqlHITT8nVdIcUJFIxMukBT0r1ed9TGawKWQNmQ7gw0oEVynvjwN8sOTn1zEfiu3brIpr/Q79zY3Klw606m4%2bIzY/z%2bmwjCFyT7n2G9OIC9e4DWy0MEzz8IaxmydCAa0UOj4aAqGcJ1LKLItSJsohtcVyoN1Un6/XVk2WldWYSOtN92Oz8lwhr0E0jQzFL6nWfDFNBnLEK9yBdjZLZ7QgDXRrH1Gm7/MerpJszOJhrZfTS7j%2bDJM7Y/f8Ia2bUmnYHscV0Gu4Zl%2bcJ4hGDCtn3mnXnQetNouidoCvT3zsTmeX7LmBebjk/b06VAoTc6cQdJmCiwP1bvVmGu1WA17HNb3mIRjE/qblmhpI9ef6TAXj0oxgpZXkyUO17Cbzm25YRR2zY4GeXdQjBU9VKrMfVaShc0Af8b0znj%2bEpw/rgO30YuTHMWYF3omtWD0LIidlUcn8pshl2Hb6OQdOPG12QSPBa16SS4CsPOVWFQsSlcWnV1BlAgVmXYuVIJsHVk8oeI7eM8AlZt8rs0AUx/otx7SQL7/q0gYGaguGUE/AV6U70gAqhRfAAAAABJRU5ErkJggg==' /%3e%3c/svg%3e\" width=\"2560\" alt=\"stateful set\" data-srcset=\"/assets/static/unifi-stateful-set.82a2fbd.a94b811e458d48df029f40ff01179b31.png 480w, /assets/static/unifi-stateful-set.cbab2cf.a94b811e458d48df029f40ff01179b31.png 1024w, /assets/static/unifi-stateful-set.2665e34.a94b811e458d48df029f40ff01179b31.png 1920w, /assets/static/unifi-stateful-set.42db587.a94b811e458d48df029f40ff01179b31.png 2560w\" data-sizes=\"(max-width: 2560px) 100vw, 2560px\" data-src=\"/assets/static/unifi-stateful-set.42db587.a94b811e458d48df029f40ff01179b31.png\"><noscript><img class=\"g-image g-image--lazy g-image--loaded\" src=\"/assets/static/unifi-stateful-set.42db587.a94b811e458d48df029f40ff01179b31.png\" width=\"2560\" alt=\"stateful set\"></noscript></p>\n<p>Here there is quite a bit to fill out. Here's the data we need to put in:</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\"> - Name: unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - Container Name: unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - Image: linuxserver/unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - Pull Policy: IfNotPresent</span></span></code></pre>\n<p>We also need to add a bunch of ports.</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\"> - 3478 UDP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - 10001 UDP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - 8080 TCP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - 8081 TCP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - 8443 TCP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - 8843 TCP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - 8880 TCP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - 6789 TCP</span></span></code></pre>\n<p>We don't need to name these or create a service just yet. We are going to create our service in a bit. We now need to add some environment variables.</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\"> - Key Pair: MEM_LIMIT: 1024M</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - Key Pair: PGID: 1000</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\"> - Key Pair: PUID: 1000</span></span></code></pre>\n<p>We also need to ensure we create our pvc in the menus. Once everything is filled out we can click create. This takes a bit and we can monitor progress in the log viewer.</p>\n<h4 id=\"installing-from-cli\"><a href=\"#installing-from-cli\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Installing from CLI</h4>\n<p>This is my prefered method. We need to create 4 files. We could do it all in 1 but I like having 4 in case I need to make updates or changes. I can then just reapply the one. Anyway, first let's create our pvc. </p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">---</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">apiVersion</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">v1</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">kind</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">PersistentVolume</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">metadata</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;unifi&quot;</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">spec</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">storageClassName</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;longhorn&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">capacity</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">storage</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;2Gi&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">accessModes</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #22863A\">ReadWriteOnce</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">---</span></span></code></pre>\n<p>Alright, now let's build our service manifest.</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #D32F2F\">apiVersion</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">v1</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">kind</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">Service</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">metadata</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">creationTimestamp</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">null</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">labels</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">app</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">spec</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">ports</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;3478&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">3478</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">protocol</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">UDP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">targetPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">3478</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;10001&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">10001</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">protocol</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">UDP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">targetPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">10001</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;8080&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8080</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">targetPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8080</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;8081&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8081</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">targetPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8081</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;8443&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8443</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">targetPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8443</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;8843&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8843</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">targetPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8843</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;8880&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8880</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">targetPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8880</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;6789&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">port</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">6789</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">targetPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">6789</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">selector</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">app</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">externalIPs</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #22863A\">&quot;192.168.1.249&quot;</span></span></code></pre>\n<p>You can set the externalIP to your choosing. Finally, let's build our statefulset deployment. </p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #D32F2F\">apiVersion</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">apps/v1</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">kind</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">StatefulSet</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">metadata</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">labels</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">app</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">spec</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">replicas</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">1</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">serviceName</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">selector</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">matchLabels</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">app</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">template</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">metadata</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">creationTimestamp</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">null</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">labels</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">        </span><span style=\"color: #D32F2F\">app</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    </span><span style=\"color: #D32F2F\">spec</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">containers</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">        - </span><span style=\"color: #D32F2F\">env</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">MEM_LIMIT</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">              </span><span style=\"color: #D32F2F\">value</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">1024M</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">PGID</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">              </span><span style=\"color: #D32F2F\">value</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;1000&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">PUID</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">              </span><span style=\"color: #D32F2F\">value</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">&quot;1000&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">          </span><span style=\"color: #D32F2F\">image</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">linuxserver/unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">          </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">          </span><span style=\"color: #D32F2F\">ports</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">containerPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">3478</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">              </span><span style=\"color: #D32F2F\">protocol</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">UDP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">containerPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">10001</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">              </span><span style=\"color: #D32F2F\">protocol</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">UDP</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">containerPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8080</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">containerPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8081</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">containerPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8443</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">containerPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8843</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">containerPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8880</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">containerPort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">6789</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">          </span><span style=\"color: #D32F2F\">volumeMounts</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            - </span><span style=\"color: #D32F2F\">mountPath</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">/config</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">              </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">restartPolicy</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">Always</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">volumes</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">        - </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">          </span><span style=\"color: #D32F2F\">persistentVolumeClaim</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            </span><span style=\"color: #D32F2F\">claimName</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi</span></span></code></pre>\n<p>Now that these are all created we can deploy them. If you are like me and have all of these in one folder without other manifests we can apply them with one short command...</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">kubectl apply -f </span><span style=\"color: #6F42C1\">.</span><span style=\"color: #24292EFF\"> --namespace unifi</span></span></code></pre>\n<p>If you have a bunch of manifests you need to specify each with -f</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">kubectl apply -f file1.yml -f file2.yml -f file3.yml -f file4.yml --namespace unifi</span></span></code></pre>\n<p>We can of course watch the deployment with </p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">kubectl get all -n unifi -o wide</span></span></code></pre>\n<p>Once everything is deployed we can browse to our externalIP on port 8443 and configure the app. If you want to setup an ingress with a custom name as we did with pihole and rancher you want to specify your ingress IP for external IP. In my case that is 192.168.1.200 but I am fine with it like this. If you want the custom ingress you can either do this in rancher in the ingress section or with a manifest</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #D32F2F\">apiVersion</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">networking.k8s.io/v1beta1</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">kind</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">Ingress</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">metadata</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">name</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #D32F2F\">spec</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">  </span><span style=\"color: #D32F2F\">rules</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">    - </span><span style=\"color: #D32F2F\">host</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi.whateverdomain.something</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">      </span><span style=\"color: #D32F2F\">http</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">        </span><span style=\"color: #D32F2F\">paths</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">          - </span><span style=\"color: #D32F2F\">path</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">/</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">            </span><span style=\"color: #D32F2F\">backend</span><span style=\"color: #D32F2F\">:</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">              </span><span style=\"color: #D32F2F\">serviceName</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #22863A\">unifi-controller</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">              </span><span style=\"color: #D32F2F\">servicePort</span><span style=\"color: #D32F2F\">:</span><span style=\"color: #24292EFF\"> </span><span style=\"color: #1976D2\">8443</span></span></code></pre>\n<h3 id=\"traefik-dashboard\"><a href=\"#traefik-dashboard\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Traefik Dashboard</h3>\n<p>This is a bonus section!! I was having some issues with ingress of my unifi container and I found that it was a certificate thing. To save you some time, you need to add --insecureSkipVerify=true to your traefik deployment. Anyway, let's get started!</p>\n<p>We need to edit the file /var/lib/rancher/k3s/server/manifests/traefik.yaml</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">sudo nano /var/lib/rancher/k3s/server/manifests/traefik.yaml</span></span></code></pre>\n<p>From here we need to add the following lines:</p>\n<pre class=\"shiki\" style=\"background-color: #ffffff\"><code><span class=\"line\"><span style=\"color: #24292EFF\">dashboard.enabled: </span><span style=\"color: #22863A\">&quot;true&quot;</span></span>\n<span class=\"line\"><span style=\"color: #24292EFF\">dashboard.domain: some.domain.homelab</span></span></code></pre>\n<p>In that section is where we would also add our line mentioned before. Save this file and deploy it with kubectl apply and we are good to go.</p>\n<h3 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusion</h3>\n<p>Our K3S cluster is performing some work for us finally! This is awesome! I encourage you to browse around Longhorn and Rancher to view things and get comfortable. The Traefik dashboard is a great place to learn also! In the next part we will add more services to our cluster and a minecraft server! Happy hacking!</p>\n<p>References:</p>\n<ul>\n<li><a href=\"https://rancher.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://rancher.com/</a></li>\n<li><a href=\"https://rancher.com/docs/rancher/v2.5/en/installation/install-rancher-on-k8s/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://rancher.com/docs/rancher/v2.5/en/installation/install-rancher-on-k8s/</a></li>\n<li><a href=\"https://rancher.com/docs/k3s/latest/en/installation/kube-dashboard/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://rancher.com/docs/k3s/latest/en/installation/kube-dashboard/</a></li>\n<li><a href=\"https://rancher.com/docs/k3s/latest/en/backup-restore/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://rancher.com/docs/k3s/latest/en/backup-restore/</a></li>\n<li><a href=\"https://longhorn.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://longhorn.io/</a></li>\n<li><a href=\"https://rancher.com/products/longhorn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://rancher.com/products/longhorn</a></li>\n<li><a href=\"https://metallb.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://metallb.org/</a></li>\n<li><a href=\"https://cert-manager.io/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://cert-manager.io/</a></li>\n<li><a href=\"https://storj.io\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://storj.io</a></li>\n</ul>\n","excerpt":"Do you work in the cloud with Kubernetes? Do you want to test things without affecting any of the clusters you work with? Well, I'm going to show you the easiest way to do it! You don't need anything","description":"k3s test lab at home","timeToRead":12,"author":{"id":"b34rd","title":"b34rd","path":"/author/b34rd/"}}}]}}},"context":{}}